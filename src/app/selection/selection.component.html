<html>
<body>
	<div class = container>

		<img id = "fileSelectImg" [src]="imgURL" height="299" width="299" (load)="onIMGLoad()">
		<div class = "fileSelection">

			<!-- <input type='file' (change)="onSelectFile($event)"> -->

			<button mat-raised-button color="basic" (click)="onUploadFileButtonClick()" (change)="onSelectFile($event)"> 
		  		Upload
			</button>	  		

			<button mat-raised-button color="primary" (click)="onSelectFileButtonClick()" (change)="onSelectFile($event)"> 
		  		Select
			</button>	  		

		</div>

		<mat-form-field>
			<mat-label>Adversarial Model</mat-label>
			<mat-select [formControl]="adversarialModel" required [disabled]="loadedModels.length==0">
				<mat-option *ngFor="let model of loadedModels" [value]="model">
					{{model}}
				</mat-option>
			</mat-select>
			<mat-error *ngIf="adversarialModel.hasError('required')"> Please select an adversarial model </mat-error>
		</mat-form-field>

		<button mat-raised-button color="basic" [disabled]="loadedModels.length==0 || adversarialModel.invalid || attackMethod.invalid || 
																						(attackMethod.value=='T-FGSM' && !targetClass.valid)" 
																						(click)="onGenerateButtonClick()">  
	  	Generate
		</button>	  		

		<mat-form-field>
			<mat-label>Prediction Model(s)</mat-label>
			<mat-select [formControl]="predictionModels" required multiple [disabled]="loadedModels.length==0">
		    <mat-select-trigger>
		      {{predictionModels.value ? predictionModels.value[0] : ''}}
		      <span *ngIf="predictionModels.value?.length > 1" class="example-additional-selection">
		        (+{{predictionModels.value.length - 1}} {{predictionModels.value?.length === 2 ? 'other' : 'others'}})
		      </span>
		    </mat-select-trigger>

				<mat-option *ngFor="let model of loadedModels" [value]="model">
					{{model}}
				</mat-option>
			</mat-select>
			<mat-error *ngIf="predictionModels.hasError('required')">Please select a prediction model</mat-error>
		</mat-form-field>

		<button mat-raised-button color="basic" [disabled]="loadedModels.length==0 || predictionModels.invalid" 
																						(click)="onPredictButtonClick()"> 
			Predict
		</button>

		<mat-form-field>
			<mat-label>Attack Method</mat-label>
			<mat-select [formControl]="attackMethod" required>
				<mat-option *ngFor="let attackMethod of availableAttackMethods" [value]="attackMethod">
					{{attackMethod}}
				</mat-option>
			</mat-select>
			<mat-error *ngIf="attackMethod.hasError('required')">Please select an attack method </mat-error>
		</mat-form-field>

		<!-- Hide this if T-FGSM is not selected -->
		<div class ="TFGSM" *ngIf="attackMethod.value=='T-FGSM'">
			<mat-form-field>
				<mat-label>Target Class</mat-label>			
		  	<input type="text" matInput [formControl]="targetClass" [matAutocomplete]="auto">
					<mat-autocomplete #auto="matAutocomplete">
	      		<mat-option *ngFor="let option of filteredImageNetClasses | async" [value]="option">
	        		{{option}}
	      		</mat-option>
					</mat-autocomplete>		 
					<mat-error *ngIf="targetClass.hasError('required')"> Please select a target class </mat-error>
			</mat-form-field>

			<button mat-raised-button color="accent" (click)="onRandomButtonClick()"> 
		  	Random
			</button>	  	
		</div>			


		<p> Epsilon: {{epsilon}} </p>
		<mat-slider 
		 	[(ngModel)]="epsilon"
			thumbLabel 
			min="0" 
			max="250"
			(change)="onEpsilonChange()"
			[disabled]="loadedModels.length==0 || adversarialModel.invalid || attackMethod.invalid || 
																						(attackMethod.value=='T-FGSM' && !targetClass.valid)" >
		</mat-slider>		


		<button mat-raised-button (click)="openModelSelectDialog()"> Open Model Selection</button>

		<div class = "tfMemoryState">
			<p> Tensors: {{numTensors}} </p>
			<p> Memory Allocated: {{numBytes}} (MB) </p>
		</div>

	</div>
</body>
</html>